version: '2'

services:
    ci:
        image: docteurklein/compose-ci
        build: .
        environment:
            GITHUB_TOKEN: $GITHUB_TOKEN
            LOG_LEVEL: DEBUG
            GARBAGE_COLLECT: '0'
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock

    tests:
        build: .
        command: bin/run-tests
        environment:
            GITHUB_TOKEN: $GITHUB_TOKEN
            GARBAGE_COLLECT: '0'
            commit: $commit
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
        depends_on:
            - ci
